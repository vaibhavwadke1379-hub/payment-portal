<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Payment Portal</title>
  <link rel="stylesheet" href="/style.css">
  
  <style>
    /* START: Added rule to hide the 'About Us' section by default */
    #about {
      display: none;
    }
    /* END: Added rule */

    .policies {
      padding: 20px 40px;
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      color: #333;
      margin-top: 50px;
      border-top: 1px solid #eee;
    }
    .policies section {
      margin-bottom: 30px;
    }
    .policies h2 {
      font-size: 1.2em;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
      margin-bottom: 15px;
    }
    .policies p {
      line-height: 1.6;
      font-size: 0.9em;
    }
  </style>
</head>

<body>
  <header class="site-header">
    <img src="/images/nirma.png" alt="Nirma University" class="logo">
  </header>

  <main class="main">
    <div class="form-box">
      <h1>Student Fee Payment</h1>

      <form id="paymentForm">
        <label for="institute">Institute :</label>
        <select id="institute" name="institute" required>
          <option value="">-- Select Institute --</option>
          <option value="Institute of Technology">Institute of Technology</option>
        </select>

        <label for="rollno">Student Roll No / Application No :</label>
        <input id="rollno" name="rollno" type="text" placeholder="Enter Roll No" required>

        <button type="submit" class="submit-btn">Submit</button>
        <div id="error" class="error"></div>
      </form>
    </div>
  </main>

  <div class="policies">
    <section id="about">
      <h2>About Us</h2>
      <p>This is an independent project by a student of Nirma University to provide a convenient online portal for fee payments. This website is not the official university portal.</p>
    </section>

    <section id="contact">
      <h2>Contact Us</h2>
      <p>For any queries regarding the payment process, please contact us.</p>
      <p><strong>Email:</strong> nirmaniversity0111@gmail.com</p>
      <p><strong>Address:</strong> Nirma University, Sarkhej-Gandhinagar Highway, Ahmedabad, Gujarat 382481</p>
    </section>

    <section id="terms">
      <h2>Terms and Conditions</h2>
      <p>By using this payment portal, you agree to the following terms. This service is provided to facilitate the payment of academic fees to Nirma University. Users are responsible for entering the correct student details. All payments are processed through our registered payment gateway partner, who is responsible for the security of your transaction data. The university is not responsible for any failed transactions due to network issues or incorrect information provided by the user.</p>
    </section>

    <section id="refund">
      <h2>Refund and Cancellation Policy</h2>
      <p>Fee payments made through this portal are generally non-refundable. Any refunds or cancellations are subject to the refund and cancellation policies of Nirma University. In case of a payment failure where your account was debited but the transaction was not successful, the amount will be automatically refunded to your account by the payment gateway within 5-7 working days.</p>
    </section>
  </div>


  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    // The rest of your JavaScript code remains the same...
    async function getPublicKey() {
      try {
        const res = await fetch('/config');
        const data = await res.json();
        return data.key || '';
      } catch (e) { return ''; }
    }

    document.getElementById('paymentForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      document.getElementById('error').textContent = '';

      const institute = document.getElementById('institute').value;
      const rollno = document.getElementById('rollno').value.trim();

      const createRes = await fetch('/create-order', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ institute, rollno })
      });

      if (!createRes.ok) {
        const err = await createRes.json().catch(()=>({ error: 'Invalid details' }));
        document.getElementById('error').textContent = err.error || 'Invalid institute or roll number';
        return;
      }

      const order = await createRes.json();
      const key = await getPublicKey();

      const options = {
        key: key,
        order_id: order.orderId,
        currency: 'INR',
        name: 'Nirma University',
        description: 'Fee Payment',
        handler: async function (response) {
          await fetch('/verify-payment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(response)
          }).then(r => {
            if (r.ok) alert('✅ Payment successful & verified');
            else alert('⚠️ Payment made but verification failed');
          }).catch(()=> alert('⚠️ Verification request failed'));
        },
        theme: { color: '#F58220' }
      };

      const rzp = new Razorpay(options);
      rzp.open();
    });
  </script>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('source') === 'compliance') {
      const aboutSection = document.getElementById('about');
      if (aboutSection) {
        aboutSection.style.display = 'block';
      }
    }
  </script>
  </body>
</html>
